<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hotel Management System</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.8/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.9/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [rooms, setRooms] = useState([]);
      const [inventory, setInventory] = useState([]);
      const [selectedRoom, setSelectedRoom] = useState(null);
      const [pin, setPin] = useState('');
      const [isAdmin, setIsAdmin] = useState(false);
      const [prices, setPrices] = useState({ firstHour: 90000, extraHour: 20000, overnight: 200000 });
      const [report, setReport] = useState({ daily: 0, weekly: 0, monthly: 0 });
      const [checkInData, setCheckInData] = useState({ items: [] });

      useEffect(() => {
        fetchRooms();
        fetchInventory();
        fetchReports();
      }, []);

      const fetchRooms = async () => {
        const response = await axios.get('/api/rooms');
        setRooms(response.data);
      };

      const fetchInventory = async () => {
        const response = await axios.get('/api/inventory');
        setInventory(response.data);
      };

      const fetchReports = async () => {
        const response = await axios.get('/api/reports');
        setReport(response.data);
      };

      const handleCheckIn = async (roomId) => {
        const response = await axios.post('/api/checkin', { roomId, items: checkInData.items, checkInTime: new Date() });
        fetchRooms();
        setCheckInData({ items: [] });
      };

      const handleCheckOut = async (roomId) => {
        const response = await axios.post('/api/checkout', { roomId });
        fetchRooms();
      };

      const handleAdminLogin = () => {
        if (pin === '123456') {
          setIsAdmin(true);
        } else {
          alert('Invalid PIN');
        }
      };

      const handlePriceUpdate = async () => {
        await axios.post('/api/prices', prices);
        alert('Prices updated');
      };

      const handleExcelImport = async (event) => {
        const file = event.target.files[0];
        const formData = new FormData();
        formData.append('file', file);
        await axios.post('/api/inventory/import', formData);
        fetchInventory();
      };

      const getRoomColor = (status) => {
        switch (status) {
          case 'occupied': return 'bg-red-500';
          case 'vacant': return 'bg-green-500';
          case 'dirty': return 'bg-yellow-500';
          default: return 'bg-gray-500';
        }
      };

      return (
        <div className="container mx-auto p-4">
          <h1 className="text-3xl font-bold mb-4">Hotel Management System</h1>
          
          {/* Admin Login */}
          {!isAdmin && (
            <div className="mb-4">
              <input
                type="password"
                placeholder="Enter Admin PIN"
                value={pin}
                onChange={(e) => setPin(e.target.value)}
                className="border p-2 mr-2"
              />
              <button onClick={handleAdminLogin} className="bg-blue-500 text-white p-2 rounded">Login</button>
            </div>
          )}

          {/* Room Management */}
          <div className="mb-8">
            <h2 className="text-2xl font-semibold mb-2">Room Status</h2>
            {['2', '3', '4'].map(floor => (
              <div key={floor} className="mb-4">
                <h3 className="text-xl font-medium">Floor {floor}</h3>
                <div className="grid grid-cols-6 gap-4">
                  {rooms.filter(room => room.floor === floor).map(room => (
                    <div
                      key={room._id}
                      className={`p-4 rounded ${getRoomColor(room.status)} text-white cursor-pointer`}
                      onClick={() => setSelectedRoom(room)}
                    >
                      Room {room.number}
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>

          {/* Check-In Modal */}
          {selectedRoom && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
              <div className="bg-white p-6 rounded">
                <h3 className="text-xl mb-4">Check-In Room {selectedRoom.number}</h3>
                <select
                  multiple
                  onChange={(e) => setCheckInData({
                    ...checkInData,
                    items: Array.from(e.target.selectedOptions, option => option.value)
                  })}
                  className="border p-2 mb-4 w-full"
                >
                  {inventory.map(item => (
                    <option key={item._id} value={item._id}>
                      {item.name} (Stock: {item.quantity}, Price: {item.price || 'Not Set'})
                    </option>
                  ))}
                </select>
                <button
                  onClick={() => handleCheckIn(selectedRoom._id)}
                  className="bg-green-500 text-white p-2 rounded mr-2"
                >
                  Check-In
                </button>
                <button
                  onClick={() => handleCheckOut(selectedRoom._id)}
                  className="bg-red-500 text-white p-2 rounded mr-2"
                >
                  Check-Out
                </button>
                <button
                  onClick={() => setSelectedRoom(null)}
                  className="bg-gray-500 text-white p-2 rounded"
                >
                  Close
                </button>
              </div>
            </div>
          )}

          {/* Admin Panel */}
          {isAdmin && (
            <div className="mb-8">
              <h2 className="text-2xl font-semibold mb-2">Admin Panel</h2>
              <div className="mb-4">
                <h3 className="text-xl">Set Prices</h3>
                <input
                  type="number"
                  placeholder="First Hour Price"
                  value={prices.firstHour}
                  onChange={(e) => setPrices({ ...prices, firstHour: e.target.value })}
                  className="border p-2 mr-2"
                />
                <input
                  type="number"
                  placeholder="Extra Hour Price"
                  value={prices.extraHour}
                  onChange={(e) => setPrices({ ...prices, extraHour: e.target.value })}
                  className="border p-2 mr-2"
                />
                <input
                  type="number"
                  placeholder="Overnight Price"
                  value={prices.overnight}
                  onChange={(e) => setPrices({ ...prices, overnight: e.target.value })}
                  className="border p-2 mr-2"
                />
                <button onClick={handlePriceUpdate} className="bg-blue-500 text-white p-2 rounded">Update Prices</button>
              </div>
              <div>
                <h3 className="text-xl">Import Inventory</h3>
                <input type="file" accept=".xlsx" onChange={handleExcelImport} className="mb-4" />
              </div>
            </div>
          )}

          {/* Reports */}
          <div>
            <h2 className="text-2xl font-semibold mb-2">Reports</h2>
            <p>Daily Revenue: {report.daily} VND</p>
            <p>Weekly Revenue: {report.weekly} VND</p>
            <p>Monthly Revenue: {report.monthly} VND</p>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
